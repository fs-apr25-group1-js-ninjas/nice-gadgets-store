# Рефакторинг системы работы с данными товаров

## Проблема

В проекте была неправильно настроена логика отображения товаров:

- Базовые данные для каталога брались из `products.json`
- Детальные данные для страниц товаров брались из `phones.json`, `tablets.json`, `accessories.json`
- Данные не были объединены, что приводило к несогласованности

## Решение

Создана единая система работы с данными товаров путем объединения всех источников данных.

## Основные изменения

### 1. Новый тип данных

**Файл:** `src/types/unifiedProduct.ts`

- Создан интерфейс `UnifiedProduct`, который объединяет данные из `Product` и `DetailedProduct`
- Детальные поля сделаны опциональными для обратной совместимости

### 2. Утилита для объединения данных

**Файл:** `src/utils/mergeProductData.ts`

- `mergeProductData()` - объединяет данные из products.json и детальных файлов по связи `products.itemId === detailedProduct.id`
- `getUnifiedProductsByCategory()` - фильтрует по категории
- `findUnifiedProductByItemId()` - находит товар по itemId
- `getProductVariants()` - получает варианты товара по namespaceId

### 3. Обновленная система запросов

**Файл:** `src/utils/firebaseUtils.ts`

- Добавлены `fetchUnifiedProducts()` и `fetchUnifiedProductsByCategory()`
- Автоматически объединяют данные из всех источников

### 4. Обновленные хуки

**Файл:** `src/hooks/useFetchProducts.ts`

- Теперь возвращает `UnifiedProduct[]` вместо `Product[]`

**Файл:** `src/hooks/useUnifiedProduct.ts`

- Новый хук для работы с товарами на страницах продуктов
- Заменяет `useDetailedProduct`

### 5. Обновленные компоненты

Обновлены все компоненты для работы с `UnifiedProduct`:

- `ProductCard`
- `ProductsSlider`
- `ProductActionsSection`
- `ProductOverviewSection`
- `ProductDescriptionSection`
- `TechSpecsSection`
- `AboutSection`
- `ProductsListSection`

### 6. Обновленные страницы

- `ProductPage` - теперь использует `useUnifiedProduct`
- `FavouritesPage` - работает с объединенными данными
- `ProductsPage` - использует новую систему типов

### 7. Обновленные секции

- `HotPricesSection`
- `BrandNewModelsSection`
- `RecommendedProductsSection`
- `ShopByCategorySection`

## Преимущества нового подхода

1. **Единый источник данных**: Все компоненты работают с одним типом данных
2. **Автоматическое объединение**: Данные автоматически объединяются при загрузке
3. **Типобезопасность**: Строгая типизация с поддержкой опциональных полей
4. **Производительность**: Данные загружаются один раз и используются повсеместно
5. **Консистентность**: Исключены расхождения между источниками данных

## Обратная совместимость

Изменения выполнены с сохранением обратной совместимости:

- Детальные поля сделаны опциональными
- Добавлены проверки на наличие данных
- Фоллбэки на базовые поля при отсутствии детальных

## Проверка работы

Проект успешно запускается и готов к использованию. Все основные функции работают с объединенными данными.
